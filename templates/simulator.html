{% extends "layout.html" %}
{% block title %}Simulator{% endblock %}
{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/editor.css') }}" media="screen">
<script src="{{ url_for('static', filename='js/construct_ui.js') }}" type="text/javascript"></script>
<script src="{{ url_for('static', filename='js/simulator_functions.js') }}" type="text/javascript"></script>
{% endblock %}
{% block content %}
    <h1>Simulator</h1>
    <div class="row">
      <div id="3js-container" class="col-md-7">
          <canvas>
          </canvas>
      </div>
      <div id="interface-container" class="bg-gray py-1 col-md-5">
        <ul class="nav nav-tabs border-bottom-0">
          <li class="ml-1 nav-item active" ><a class="nav-link px-1" data-toggle="tab"  href="#sim-config">Simulation <span class="fas fa-wrench"></span></a></li>
          <li class="nav-item"><a class="nav-link px-1" data-toggle="tab" href="#src-config">Sources  <span class="fas fa-volume-up"></span></a></li>
          <li class="nav-item"><a class="nav-link px-1" data-toggle="tab" id="code-tab" href="#code">Code <span class="fas fa-code"></span></a></li>
          <li class="ml-auto nav-item"><a class="btn btn-primary text-white px-1" id="run_conf">Run <span class="fas fa-play"></span></a></li>
        </ul>
        <div class="tab-content bg-white rounded-top p-1">
          <div class="tab-pane active tall no-hor-scroll" id="sim-config">
            <h2 class="text-center">Simulation Configuration</h2>
            <div class="mx-0" id="room-dim"></div>
            <div class="mx-0" id="robo-pos"></div>
            <div class="mx-0" id="rt-60"></div>
            <div class="mx-0" id="sample-rate"></div>
          </div><!-- sim tab -->
          <div class="tab-pane" id="src-config">
            <h2 class="text-center"> Source Configuration</h2>
            <hr>
            <div class="row mx-0">
              <button class="btn btn-info col-md-1" id="add-src"><span class="fas fa-plus"></span></button>
            </div>
            <div class="pre-scrollable tall no-hor-scroll" id="src-setups">

            </div>
          </div><!-- source tab -->
          <div class="tab-pane" id="code">
            <div id="editor"></div>
            <div id="upload_controls" class="btn-toolbar justify-content-between" role="toolbar">
              <div class="btn-group" role="group">
                <input type="file" name="fileselect" class="btn btn-secondary" id="fileselect" size="1"/>
                <button type="submit" id="fileupload" class="btn btn-info">Upload</button>
              </div>
            </div>
          </div><!-- code tab -->
        </div><!-- tab content -->

        <form id="sound-uploads-form" action="/simulator/uploadsounds" class=" bg-white rounded-bottom p-1" enctype="multipart/form-data" method="POST">
          <hr>
          <div id="utterance-input-controls" class="btn-toolbar" role="toolbar">
            <div class="input-group mr-2 my-2" role="group">
              <label for="utterancefile" class="input-group-text">Utterance</label>
              <input type="file" name="utterancefile" class="btn btn-secondary" id="utterancefile" size="1"/>
              <select id="utterance-select" class="w-75 mx-auto">
                  <option value="-1">Upload other file.</option>
                  {% for sound in sounds: %}
                  <option value="{{sound.id}}">{{ sound.name }}</option>
                  {% endfor %}
              </select>
            </div>
          </div>
          <div id="select-input-controls" class="btn-toolbar" role="toolbar">
            <div class="input-group mr-2 my-2" role="group">
              <label for="robot-select" class="input-group-text">Robot</label>
              <!-- <input type="file" name="utterancefile" class="btn btn-secondary" id="utterancefile" size="1"/> -->
              <select id="robot-select">
                  {% for robot in robots: %}
                  <option value="{{robot.id}}">{{ robot.name }}</option>
                  {% endfor %}
              </select>
            </div>
          </div>
        </form>
      </div>
    </div>
    <section id="uploadpopup" class="modal fade">
      <div class="modal-dialog">
        <div class="modal-body">
          <div id="spinner" class="loading">
            Loading&#8230;
          </div>
          <p>Uploading...</p>
        </div>
        <div class="modal-footer">
          <p>please wait</p>
        </div>
      </div>
    </section>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.2/ace.js" type="text/javascript"></script>
{% endblock %}
{% block templates %}
<template id="source-block">
  <div id="{id}" class="my-1">
    <div class="row input-group mx-0" id="{id}-tr">
      <select class="col-md-10" id="{id}-sel">
        <option value="single">single</option>
        <option value="box">box</option>
        <option value="sphere">sphere</option>
        <option value="pyramid">pyramid</option>
      </select>
      <button class="btn btn-info col-md-1 p-0" id="{id}-col" data-toggle="collapse" data-target="#{id}-body" aria-example="True" aria-controls="{id}-body">
        <fas-icon icon-name="sort-down"></fas-icon>
      </button>
      <button class="btn btn-danger col-md-1 p-0" id="{id}-del"><fas-icon icon-name="minus"></fas-icon></button>
    </div>
    <div class="collapse" id="{id}-body">
      <div id="{id}-single">
        <vec3-input label="Position" value="0.0" step="0.25" id-suffix="pos" label-style="POS"></vec3-input>
      </div>
      <div id="{id}-box">
        <vec3-input label="Dimensions" label-style="DIM" value="1.0" step="0.25" id-suffix="dim"></vec3-input>
        <vec3-input label="Divisions"  label-style="DIM" value="2.0" step="1.0" id-suffix="div"></vec3-input>
        <vec3-input label="Origin" label-style="POS" value="2.5" step="0.25" id-suffix="pos"></vec3-input>
      </div>
      <div id="{id}-sphere">
        <number-input label="Rings"  value="4.0" step="1.0" id-suffix="rings"></number-input>
        <number-input label="Segments"  value="8.0" step="1.0" id-suffix="segs"></number-input>
        <number-input label="Radius" value="4.0" step="0.25" id-suffix="rad"></number-input>
        <vec3-input label="Origin" label-style="POS" value="2.5" step="0.25" id-suffix="pos"></vec3-input>
      </div>
      <div id="{id}-pyramid">
        <number-input label="Divisions" value="3.0" step="1.0" id-suffix="divs"></number-input>
        <number-input label="Layers" value="4.0" step="1.0" id-suffix="lays"></number-input>
        <number-input label="Length" value="8.0" step="0.25" id-suffix="len"></number-input>
        <number-input label="Angle"  value="30.0" step="5.0" id-suffix="ang"></number-input>
        <vec3-input label="Origin" label-style="POS" value="2.5" step="0.25" id-suffix="pos"></vec3-input>
      </div>

    </div>
  </div>
</template> <!-- Template for a source panel -->
{% endblock %}
